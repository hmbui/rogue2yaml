##############################################################################
## This file is part of 'SLAC Firmware Standard Library'.
## It is subject to the license terms in the LICENSE.txt file found in the 
## top-level directory of this distribution and at: 
##    https://confluence.slac.stanford.edu/display/ppareg/LICENSE.html. 
## No part of 'SLAC Firmware Standard Library', including this file, 
## may be copied, modified, propagated, or distributed except according to 
## the terms contained in the LICENSE.txt file. 
############################################################################## 
#schemaversion 3.0.0 
#once DaqMuxV2.yaml 


DaqMuxV2: &DaqMuxV2
  description: Waveform Data Acquisition Module
  configPrio: 1
  class: MMIODev
  size: 0x8
  ##########
  children:
  ##########
    ################################################################################
    TriggerSw:
      at:
        offset: 0x0
        byteOrder: BE
      description: Software Trigger (triggers DAQ on all enabled channels).
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    TriggerCascMask:
      at:
        offset: 0x0
        byteOrder: BE
      description: Mask for enabling/disabling cascaded trigger.
      class: IntField
      sizeBits: 8
      lsBit: 1
      mode: RW
    ################################################################################
    TriggerHwAutoRearm:
      at:
        offset: 0x0
        byteOrder: BE
      description: Mask for enabling/disabling hardware trigger. If disabled it has
        to be rearmed by ArmHwTrigger.
      class: IntField
      sizeBits: 8
      lsBit: 2
      mode: RW
    ################################################################################
    TriggerHwArm:
      at:
        offset: 0x0
        byteOrder: BE
      description: Arm the Hardware trigger (On the rising edge). After trigger occurs
        the trigger has to be rearmed.
      class: IntField
      sizeBits: 8
      lsBit: 3
      mode: RW
    ################################################################################
    TriggerClearStatus:
      at:
        offset: 0x0
        byteOrder: BE
      description: Trigger status will be cleared (On the rising edge).
      class: IntField
      sizeBits: 8
      lsBit: 4
      mode: RW
    ################################################################################
    DaqMode:
      at:
        offset: 0x0
        byteOrder: BE
      description: Select the data ackuisition mode.
      class: IntField
      sizeBits: 8
      lsBit: 5
      mode: RW
    ################################################################################
    PacketHeaderEn:
      at:
        offset: 0x0
        byteOrder: BE
      description: Applies only to Triggered mode.
      class: IntField
      sizeBits: 8
      lsBit: 6
      mode: RW
    ################################################################################
    FreezeSw:
      at:
        offset: 0x0
        byteOrder: BE
      description: Software freeze buffer (Freezes all enabled circular buffers).
      class: IntField
      sizeBits: 8
      lsBit: 7
      mode: RW
    ################################################################################
    FreezeHwMask:
      at:
        offset: 0x1
        byteOrder: BE
      description: Mask for enabling/disabling hardware freaze buffer request.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    TriggerSwStatus:
      at:
        offset: 0x4
        byteOrder: BE
      description: Software Trigger Status (Registered on first trigger until cleared
        by TriggerClearStatus).
      class: IntField
      sizeBits: 8
      mode: RO
    ################################################################################
    TriggerCascStatus:
      at:
        offset: 0x4
        byteOrder: BE
      description: Cascade Trigger Status (Registered on first trigger until cleared
        by TriggerClearStatus).
      class: IntField
      sizeBits: 8
      lsBit: 1
      mode: RO
    ################################################################################
    TriggerHwStatus:
      at:
        offset: 0x4
        byteOrder: BE
      description: Hardware Trigger Status (Registered on first trigger until cleared
        by TriggerClearStatus).
      class: IntField
      sizeBits: 8
      lsBit: 2
      mode: RO
    ################################################################################
    TriggerHwArmed:
      at:
        offset: 0x4
        byteOrder: BE
      description: Hardware Trigger Armed Status (Registered on rising edge Control(3)
        and cleared when Hw trigger occurs).
      class: IntField
      sizeBits: 8
      lsBit: 3
      mode: RO
    ################################################################################
    TriggerStatus:
      at:
        offset: 0x4
        byteOrder: BE
      description: Combined Trigger Status (Registered on first trigger until cleared
        by TriggerClearStatus).
      class: IntField
      sizeBits: 8
      lsBit: 4
      mode: RO
    ################################################################################
    FreezeStatus:
      at:
        offset: 0x4
        byteOrder: BE
      description: Freeze Buffers Status (Registered on first freeze until cleared
        by TriggerClearStatus)
      class: IntField
      sizeBits: 8
      lsBit: 5
      mode: RO
    ################################################################################
    DecimationRateDiv:
      at:
        offset: 0x8
        byteOrder: BE
      description: Averaging Enabled: (powers of two) 1,2,4,8,16,etc (max 2^12).
        Averaging Disabled (32-bit): 1,2,3,4,etc (max 2^16-1). Averaging Disabled
        (16-bit): 1,2,4,6,8,etc (max 2^16-1).
      class: IntField
      sizeBits: 16
      mode: RW
    ################################################################################
    DataBufferSize:
      at:
        offset: 0xc
        byteOrder: BE
      description: Number of 32-bit words. Minimum size is 4.
      class: IntField
      sizeBits: 32
      mode: RW
    ################################################################################
    Timestamp:
      at:
        offset: 0x10
        byteOrder: BE
        nelms: 2
      description: Timestamp 63:0
      class: IntField
      sizeBits: 32
      mode: RO
    ################################################################################
    Bsa:
      at:
        offset: 0x18
        byteOrder: BE
        nelms: 2
      description: bsa(0) - edefAvgDn, bsa(1) - edefMinor, bsa(2) - edefMajor, bsa(3)
        - edefInit
      class: IntField
      sizeBits: 32
      mode: RO
    ################################################################################
    TrigCount:
      at:
        offset: 0x28
        byteOrder: BE
      description: Counts valid data acquisition triggers.
      class: IntField
      sizeBits: 32
      mode: RO
    ################################################################################
    DbgInputValid:
      at:
        offset: 0x2c
        byteOrder: BE
      description: Input Valid bus for debugging
      class: IntField
      sizeBits: 32
      mode: RO
    ################################################################################
    DbgLinkReady:
      at:
        offset: 0x30
        byteOrder: BE
      description: Input LinkReady bus for debugging
      class: IntField
      sizeBits: 32
      mode: RO
    ################################################################################
    InputMuxSel:
      at:
        offset: 0x40
        byteOrder: BE
        nelms: 2
      description: Input Mux select. Maximum number of channels is 29.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    StreamPause:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: Raw diagnostic stream control Pause.
      class: IntField
      sizeBits: 8
      mode: RO
    ################################################################################
    StreamReady:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: Raw diagnostic stream control Ready.
      class: IntField
      sizeBits: 8
      lsBit: 1
      mode: RO
    ################################################################################
    StreamOverflow:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: Raw diagnostic stream control Overflow.
      class: IntField
      sizeBits: 8
      lsBit: 2
      mode: RO
    ################################################################################
    StreamError:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: Error during last Acquisition (Raw diagnostic stream control Ready
        or incoming data valid dropped).
      class: IntField
      sizeBits: 8
      lsBit: 3
      mode: RO
    ################################################################################
    InputDataValid:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: The incoming data is Valid (Usually connected to JESD valid signal).
      class: IntField
      sizeBits: 8
      lsBit: 4
      mode: RO
    ################################################################################
    StreamEnabled:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: Output stream enabled.
      class: IntField
      sizeBits: 8
      lsBit: 5
      mode: RO
    ################################################################################
    FrameCnt:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: Number of 4096 byte frames sent.
      class: IntField
      sizeBits: 32
      lsBit: 6
      mode: RO
    ################################################################################
    FormatSignWidth:
      at:
        offset: 0xc0
        byteOrder: BE
        nelms: 2
      description: Indicating sign extension point.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    FormatDataWidth:
      at:
        offset: 0xc0
        byteOrder: BE
        nelms: 2
      description: Data width 32-bit or 16-bit.
      class: IntField
      sizeBits: 8
      lsBit: 5
      mode: RW
    ################################################################################
    FormatSign:
      at:
        offset: 0xc0
        byteOrder: BE
        nelms: 2
      description: Sign format.
      class: IntField
      sizeBits: 8
      lsBit: 6
      mode: RW
    ################################################################################
    DecimationAveraging:
      at:
        offset: 0xc0
        byteOrder: BE
        nelms: 2
      description: Decimation Averaging.
      class: IntField
      sizeBits: 8
      lsBit: 7
      mode: RW
    ################################################################################
    TriggerDaq:
      at:
        offset: 0x0
      name: TriggerDaq
      description: Trigger data aquisition from software
      class: SequenceCommand
    ################################################################################
    ArmHwTrigger:
      at:
        offset: 0x0
      name: ArmHwTrigger
      description: Arm Hardware Trigger
      class: SequenceCommand
    ################################################################################
    FreezeBuffers:
      at:
        offset: 0x0
      name: FreezeBuffers
      description: Freeze circular buffers from software
      class: SequenceCommand
    ################################################################################
    ClearTrigStatus:
      at:
        offset: 0x0
      name: ClearTrigStatus
      description: Clear the status
      class: SequenceCommand
    ################################################################################
