##############################################################################
## This file is part of 'SLAC Firmware Standard Library'.
## It is subject to the license terms in the LICENSE.txt file found in the 
## top-level directory of this distribution and at: 
##    https://confluence.slac.stanford.edu/display/ppareg/LICENSE.html. 
## No part of 'SLAC Firmware Standard Library', including this file, 
## may be copied, modified, propagated, or distributed except according to 
## the terms contained in the LICENSE.txt file. 
############################################################################## 
#schemaversion 3.0.0 
#once _JesdTx.yaml 


JesdTx: &JesdTx
  description: JESD TX Module
  configPrio: 1
  class: MMIODev
  size: 0x8
  ##########
  children:
  ##########
    ################################################################################
    Enable:
      at:
        offset: 0x0
        byteOrder: BE
      description: Enable mask. Example: 0x3 Enable ln0 and ln1.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    Polarity:
      at:
        offset: 0x8
        byteOrder: BE
      description: 0 = non-inverted, 1 = inverted
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    Loopback:
      at:
        offset: 0xc
        byteOrder: BE
      description: 0 = normal mode, 1 = internal loopback
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    SubClass:
      at:
        offset: 0x10
        byteOrder: BE
      description: Jesd204b SubClass. 0 - For designs without sysref (no fixed latency).
        1 - Fixed latency.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    ReplaceEnable:
      at:
        offset: 0x10
        byteOrder: BE
      description: ReplaceEnable. Replace the control characters with data. (Should
        be 1 use 0 only for debug).
      class: IntField
      sizeBits: 8
      lsBit: 1
      mode: RW
    ################################################################################
    ResetGTs:
      at:
        offset: 0x10
        byteOrder: BE
      description: ResetGTs. Request reset of the GT modules.
      class: IntField
      sizeBits: 8
      lsBit: 2
      mode: RW
    ################################################################################
    ClearErrors:
      at:
        offset: 0x10
        byteOrder: BE
      description: Clear Jesd Errors and reset the status counters.
      class: IntField
      sizeBits: 8
      lsBit: 3
      mode: RW
    ################################################################################
    InvertSync:
      at:
        offset: 0x10
        byteOrder: BE
      description: InvertSync. Invert sync input (the AMC card schematics should
        be checkes if inverted). 
      class: IntField
      sizeBits: 8
      lsBit: 4
      mode: RW
    ################################################################################
    TestSigEnable:
      at:
        offset: 0x10
        byteOrder: BE
      description: Invert Sync. Sync output has to be inverted in some systems depending
        on signal polarities on the PCB.
      class: IntField
      sizeBits: 8
      lsBit: 5
      mode: RW
    ################################################################################
    ScrambleEnable:
      at:
        offset: 0x10
        byteOrder: BE
      description: ScrambleEnable. Enable data scrambling (More info in Jesd204b
        standard). 
      class: IntField
      sizeBits: 8
      lsBit: 6
      mode: RW
    ################################################################################
    RampStep:
      at:
        offset: 0x14
        byteOrder: BE
      description: Ramp increment step and a period of the wave in c-c
      class: IntField
      sizeBits: 16
      mode: RW
    ################################################################################
    SquarePeriod:
      at:
        offset: 0x14
        byteOrder: BE
      description: Ramp increment step and a period of the wave in c-c
      class: IntField
      sizeBits: 32
      mode: RW
    ################################################################################
    LowAmplitudeVal:
      at:
        offset: 0x18
        byteOrder: BE
      description: Low value of the square waveform amplitude
      class: IntField
      sizeBits: 32
      mode: RW
    ################################################################################
    HighAmplitudeVal:
      at:
        offset: 0x1c
        byteOrder: BE
      description: High value of the square waveform amplitude
      class: IntField
      sizeBits: 32
      mode: RW
    ################################################################################
    InvertDacData:
      at:
        offset: 0x20
        byteOrder: BE
      description: Mask Enable the DAC data inversion. 1-Inverted, 0-normal.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    GTReady:
      at:
        offset: 0x40
        byteOrder: BE
      description: GT Ready. Jesd clock ok PLLs are locked and GT is ready to receive
        data.
      class: IntField
      sizeBits: 72
      mode: RO
    ################################################################################
    DataValid:
      at:
        offset: 0x40
        byteOrder: BE
      description: Jesd Data Valid. Goes high after the code synchronization and ILAS
        sequence is complete (More info in Jesd204b standard).
      class: IntField
      sizeBits: 72
      lsBit: 1
      mode: RO
    ################################################################################
    IlasActive:
      at:
        offset: 0x40
        byteOrder: BE
      description: ILA sequence Active. Only 1 for 4 multiframe clock cycles then
        it drops (More info in Jesd204b standard).
      class: IntField
      sizeBits: 72
      lsBit: 2
      mode: RO
    ################################################################################
    nSync:
      at:
        offset: 0x40
        byteOrder: BE
      description: nSync. 0 - Not synchronised. 1 - Indicades that code group synchronization
        has been completed.
      class: IntField
      sizeBits: 72
      lsBit: 3
      mode: RO
    ################################################################################
    TxEnabled:
      at:
        offset: 0x40
        byteOrder: BE
      description: Tx Lane Enabled. Indicates if the lane had been enabled in configuration.
      class: IntField
      sizeBits: 72
      lsBit: 4
      mode: RO
    ################################################################################
    SysRefDetected:
      at:
        offset: 0x40
        byteOrder: BE
      description: System Reference input has been Detected.
      class: IntField
      sizeBits: 72
      lsBit: 5
      mode: RO
    ################################################################################
    StatusValidCnt:
      at:
        offset: 0x100
        byteOrder: BE
        nelms: 2
      description: StatusValidCnt[31:0]. Shows stability of JESD lanes. Counts number
        of JESD re-syncronisations.
      class: IntField
      sizeBits: 32
      mode: RO
    ################################################################################
    txDiffCtrl:
      at:
        offset: 0x200
        byteOrder: BE
        nelms: 2
      description: TX diff. swing control
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    txPostCursor:
      at:
        offset: 0x200
        byteOrder: BE
        nelms: 2
      description: TX post cursor control
      class: IntField
      sizeBits: 16
      mode: RW
    ################################################################################
    txPreCursor:
      at:
        offset: 0x200
        byteOrder: BE
        nelms: 2
      description: TX pre cursor control
      class: IntField
      sizeBits: 24
      mode: RW
    ################################################################################
    dataOutMux:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: data_out_mux: Select between: b000 - Output zero, b001 - Parallel
        data from inside FPGA, b010 - Data from AXI stream (not used), b011 - Test
        data
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    testOutMux:
      at:
        offset: 0x80
        byteOrder: BE
        nelms: 2
      description: test_out_mux[1:0]: Select between: b000 - Saw signal increment,
        b001 - Saw signal decrement, b010 - Square wave,  b011 - Output zero
      class: IntField
      sizeBits: 8
      lsBit: 4
      mode: RW
    ################################################################################
    CmdClearErrors:
      at:
        offset: 0x0
      name: CmdClearErrors
      description: Clear the status valid counter of TX lanes.
      class: SequenceCommand
    ################################################################################
    CmdResetGTs:
      at:
        offset: 0x0
      name: CmdResetGTs
      description: Toggle the reset of all TX MGTs
      class: SequenceCommand
    ################################################################################
