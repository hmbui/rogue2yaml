##############################################################################
## This file is part of 'SLAC Firmware Standard Library'.
## It is subject to the license terms in the LICENSE.txt file found in the 
## top-level directory of this distribution and at: 
##    https://confluence.slac.stanford.edu/display/ppareg/LICENSE.html. 
## No part of 'SLAC Firmware Standard Library', including this file, 
## may be copied, modified, propagated, or distributed except according to 
## the terms contained in the LICENSE.txt file. 
############################################################################## 
#schemaversion 3.0.0 
#once _JesdRx.yaml 


JesdRx: &JesdRx
  description: JESD RX Module
  configPrio: 1
  class: MMIODev
  size: 0x8
  ##########
  children:
  ##########
    ################################################################################
    Enable:
      at:
        offset: 0x0
        byteOrder: BE
      description: Enable mask. Example: 0x3F Enable ln0 to ln5.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    SysrefDelay:
      at:
        offset: 0x4
        byteOrder: BE
      description: Sets the system reference delay in clock cycles. Use if you want
        to reduce the latency (The latency is indicated by ElBuffLatency status). 
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    Polarity:
      at:
        offset: 0x8
        byteOrder: BE
      description: 0 = non-inverted, 1 = inverted
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    SubClass:
      at:
        offset: 0x10
        byteOrder: BE
      description: Jesd204b SubClass. 0 - For designs without sysref (no fixed latency).
        1 - Fixed latency.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    ReplaceEnable:
      at:
        offset: 0x10
        byteOrder: BE
      description: ReplaceEnable. Replace the control characters with data. (Should
        be 1 use 0 only for debug).
      class: IntField
      sizeBits: 8
      lsBit: 1
      mode: RW
    ################################################################################
    ResetGTs:
      at:
        offset: 0x10
        byteOrder: BE
      description: ResetGTs. Request reset of the GT modules.
      class: IntField
      sizeBits: 8
      lsBit: 2
      mode: RW
    ################################################################################
    ClearErrors:
      at:
        offset: 0x10
        byteOrder: BE
      description: Clear Jesd Errors and reset the status counters.
      class: IntField
      sizeBits: 8
      lsBit: 3
      mode: RW
    ################################################################################
    InvertSync:
      at:
        offset: 0x10
        byteOrder: BE
      description: Invert Sync. Sync output has to be inverted in some systems depending
        on signal polarities on the PCB.
      class: IntField
      sizeBits: 8
      lsBit: 4
      mode: RW
    ################################################################################
    ScrambleEnable:
      at:
        offset: 0x10
        byteOrder: BE
      description: ScrambleEnable. Enable data scrambling (More info in Jesd204b standard).
      class: IntField
      sizeBits: 8
      lsBit: 5
      mode: RW
    ################################################################################
    LinkErrMask:
      at:
        offset: 0x14
        byteOrder: BE
      description: Mask Enable the errors that are required to brake the link. bit
        5-0: positionErr - s_bufOvf - s_bufUnf - dispErr - decErr - s_alignErr
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    InvertAdcData:
      at:
        offset: 0x18
        byteOrder: BE
      description: Mask Enable the ADC data inversion. 1-Inverted, 0-normal.
      class: IntField
      sizeBits: 8
      mode: RW
    ################################################################################
    GTReady:
      at:
        offset: 0x40
        byteOrder: BE
      description: GT Ready. Jesd clock ok PLLs are locked and GT is ready to receive
        data.
      class: IntField
      sizeBits: 168
      mode: RO
    ################################################################################
    DataValid:
      at:
        offset: 0x40
        byteOrder: BE
      description: Jesd Data Valid. Goes high after the code synchronization and ILAS
        sequence is complete (More info in Jesd204b standard).
      class: IntField
      sizeBits: 168
      lsBit: 1
      mode: RO
    ################################################################################
    AlignErr:
      at:
        offset: 0x40
        byteOrder: BE
      description: Jesd Character Alignment Error. The control characters in the data
        are missaligned. This error will trigger JESD re-synchronization.
      class: IntField
      sizeBits: 168
      lsBit: 2
      mode: RO
    ################################################################################
    nSync:
      at:
        offset: 0x40
        byteOrder: BE
      description: Synchronisation request. 0 - Not synchronised. 1 - Indicades that
        code group synchronization has been completed.
      class: IntField
      sizeBits: 168
      lsBit: 3
      mode: RO
    ################################################################################
    RxBuffUfl:
      at:
        offset: 0x40
        byteOrder: BE
      description: Jesd sync fifo buffer undeflow. This error will trigger JESD re-synchronization.
      class: IntField
      sizeBits: 168
      lsBit: 4
      mode: RO
    ################################################################################
    RxBuffOfl:
      at:
        offset: 0x40
        byteOrder: BE
      description: Jesd elastic buffer overflow. This error will trigger JESD re-synchronization.
      class: IntField
      sizeBits: 168
      lsBit: 5
      mode: RO
    ################################################################################
    PositionErr:
      at:
        offset: 0x40
        byteOrder: BE
      description: The position of K28.5 character during code group synchronization
        is wrong. This error will trigger JESD re-synchronization.
      class: IntField
      sizeBits: 168
      lsBit: 6
      mode: RO
    ################################################################################
    RxEnabled:
      at:
        offset: 0x40
        byteOrder: BE
      description: Rx Lane Enabled. Indicates if the lane had been enabled in configuration.
      class: IntField
      sizeBits: 168
      lsBit: 7
      mode: RO
    ################################################################################
    SysRefDetected:
      at:
        offset: 0x40
        byteOrder: BE
      description: System Reference input has been Detected.
      class: IntField
      sizeBits: 176
      mode: RO
    ################################################################################
    CommaDetected:
      at:
        offset: 0x40
        byteOrder: BE
      description: The K28.5 characters detected in the serial stream. 
      class: IntField
      sizeBits: 176
      lsBit: 1
      mode: RO
    ################################################################################
    DisparityErr:
      at:
        offset: 0x40
        byteOrder: BE
        nelms: 2
      description: Latched High when the data byte on RXDATA arrives with the wrong
        disparity. Indicates bad serial connection (Check HW).
      class: IntField
      sizeBits: 16
      lsBit: 2
      mode: RO
    ################################################################################
    NotInTableErr:
      at:
        offset: 0x40
        byteOrder: BE
        nelms: 2
      description: NotInTableErr. When GT decoder received s 10-bit character that
        cannot be mapped into a valid 8B/10B character. Indicates bad serial connection
        (Check HW).
      class: IntField
      sizeBits: 24
      lsBit: 6
      mode: RO
    ################################################################################
    ElBuffLatency:
      at:
        offset: 0x40
        byteOrder: BE
        nelms: 2
      description: Jesd204b elastic buffer latency in c-c. Can be adjusted by Sysref
        delay.
      class: IntField
      sizeBits: 32
      lsBit: 2
      mode: RO
    ################################################################################
    StatusValidCnt:
      at:
        offset: 0x100
        byteOrder: BE
        nelms: 2
      description: StatusValidCnt. Shows stability of JESD lanes. Counts number of
        JESD re-syncronisations.
      class: IntField
      sizeBits: 32
      mode: RO
    ################################################################################
    RawData:
      at:
        offset: 0x140
        byteOrder: BE
        nelms: 2
      description: Raw data from GT.
      class: IntField
      sizeBits: 32
      mode: RO
    ################################################################################
    CmdClearErrors:
      at:
        offset: 0x0
      name: CmdClearErrors
      description: Clear the status valid counter of RX lanes.
      class: SequenceCommand
    ################################################################################
    CmdResetGTs:
      at:
        offset: 0x0
      name: CmdResetGTs
      description: Toggle the reset of all RX MGTs
      class: SequenceCommand
    ################################################################################
